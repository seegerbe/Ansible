---
# IIS website test
  - include: enable-iis.yml

  - name: Deploy site to IIS
    hosts: all
    tasks:
#       # taken from ansible-examples github
#       - name: Install IIS
#         hosts: all
#         gather_facts: false
#         tasks:
#           - name: Install IIS
#             win_feature:
#               name: "Web-Server"
#               state: present
#               restart: yes
#               include_sub_features: yes
#               include_management_tools: yes

      - name: Add oakgov directory
        win_file: path=C:\inetpub\wwwroot\oakgov state=directory
#          path: "C:\sites\oakgov"
#          state: directory

      - name: Add log directory
        win_file: path=C:\sites\log state=directory
#          path: "C:\sites\log"
#          state: directory

      - name: Pull html file
        win_get_url: 
          url: 'https://raw.githubusercontent.com/bambino0429/website/master/index.html'
          dest: 'C:\inetpub\wwwroot\oakgov\index.html'
          skip_certificate_validation: true

      - name: OakGov IIS site
        win_iis_website:
          name: "OakGov"
          state: started
          hostname: oakgov.local
          physical_path: 'c:\inetpub\wwwroot\oakgov'
          parameters: 'logfile.directory:c:\sites\log'
        register: website
